(this["webpackJsonpbrowser-testbench"]=this["webpackJsonpbrowser-testbench"]||[]).push([[0],{20:function(e,t,n){},21:function(e,t,n){},22:function(e,t,n){"use strict";n.r(t);var r=n(7),c=n(8),o=n(12),s=n(11),i=n(0),a=n(1),u=n.n(a),l=n(9),d=n.n(l),h=n(2),b=n(3),j=n.n(b),f=n(4);function g(e,t){return(""+t).padStart(e,"0")}function p(){var e=new Date;return"".concat(e.getHours(),":").concat(g(2,e.getMinutes()),":").concat(g(2,e.getSeconds()),".").concat(g(3,e.getMilliseconds()))}function x(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t="",n=0;n<e;n++)t+="1234567891"[Math.floor(9*Math.random())];return t}function O(e){var t=e.children;return Object(i.jsx)("div",{className:"log-viewer",children:t.map((function(e,t){var n=Object(h.a)(e,2),r=n[0],c=n[1];return Object(i.jsx)("pre",{className:"log-line log-line-"+c,children:Object(i.jsx)("code",{children:r})},t)}))})}function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{var r=t();r&&"function"===typeof r.catch&&r.catch((function(t){console.warn(t),n&&n(t)||(e.log(""+t,"error"),e.done(!1))}))}catch(c){console.warn(c),e.log(""+c,"error"),e.done(!1)}}function y(e,t){if(!e)throw new Error(t)}function v(e,t){for(var n=[],r=e;r<t;r++)n.push(r);return n}function w(e){var t=e.src,n=e.onLoad,r=e.onError,c=e.bench,o=Object(a.useState)(!0),s=Object(h.a)(o,2),u=s[0],l=s[1],d=Object(a.useState)(null),b=Object(h.a)(d,2),g=b[0],p=b[1];return Object(a.useEffect)((function(){m(c,Object(f.a)(j.a.mark((function e(){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x(),e.next=3,fetch(t,{headers:{"x-cache-key":n}});case 3:return r=e.sent,e.t0=p,e.t1=URL,e.next=8,r.blob();case 8:e.t2=e.sent,e.t3=e.t1.createObjectURL.call(e.t1,e.t2),(0,e.t0)(e.t3),l(!1);case 12:case"end":return e.stop()}}),e)}))))}),[c,t]),Object(a.useEffect)((function(){return function(){g&&URL.revokeObjectURL(g)}}),[g]),u?"loading...":Object(i.jsx)("img",{src:g,onLoad:n,onError:r,alt:"img"})}function k(e){return L.apply(this,arguments)}function L(){return(L=Object(f.a)(j.a.mark((function e(t){var n,r,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x(),e.next=3,fetch("/cgi-bin/setblock?"+n+","+(t?1:0));case 3:return y(200===(r=e.sent).status,"setblock failed with status "+r.status),e.next=7,r.text();case 7:y("ok"===(c=e.sent),"setblock failed with text "+c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return E.apply(this,arguments)}function E(){return(E=Object(f.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout(e,t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){for(var n="";t--;)n+=e;return n}var R="running",_="passed",I="failed",C="unknown";var P=n(10);var q=30;var U=n(13);function D(e,t){return new Promise((function(n,r){window.addEventListener("message",(function(e){return n(e.data)}),!0),e.postMessage(t,"*"),setTimeout((function(){r("timeout!")}),2e3)}))}var N=[["proxy-sancheck",function(e){var t=e.bench;return Object(a.useEffect)((function(){m(t,Object(f.a)(j.a.mark((function e(){var n,r,c,o,s,i,a,u,l,d;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x(),r="/cgi-bin/pingpong?"+n,t.log("requesting "+r),e.next=5,fetch(r,{mode:"same-origin",headers:{"X-Louder":"You're my everything"}});case 5:c=e.sent,t.log("status code = "+c.status+" "+c.statusText),y(200===c.status,"bad status code, should be 200"),o=!1,s=Object(P.a)(c.headers);try{for(s.s();!(i=s.n()).done;)a=Object(h.a)(i.value,2),u=a[0],l=a[1],t.log("response headers = "+u+": "+l,"debug"),"server"===u.toLowerCase()&&"tiny web server"===l.toLowerCase()&&(o=!0)}catch(b){s.e(b)}finally{s.f()}return y(o,'expecting "server: tiny web server" in response header. your proxy should pass all response headers to client!'),e.next=14,c.text();case 14:d=e.sent,t.log("response body = "+d,"debug"),y(-1!==d.toLowerCase().indexOf("this is ping-pong service."),'expecting "this is ping-pong service." in body'),y(-1!==d.toLowerCase().indexOf("your query string: "+n),'expecting "Your query string: xxxxxxxx" in body'),y(-1!==d.toLowerCase().replace(/\s/g,"").indexOf("x-louder:you'remyeverything"),"expecting correct X-Louder in body. your proxy should pass all request headers to server!"),y(-1!==d.toLowerCase().indexOf("gecko/20120305 firefox/10.0.3"),"expecting correct User-Agent in body. your proxy should use the string provided in writeup!"),t.done(!0);case 21:case"end":return e.stop()}}),e)}))))}),[t]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Proxy Sanity Check"}),Object(i.jsxs)("p",{children:["In this test, we request ",Object(i.jsx)("code",{children:"/cgi-bin/pingpong"})," and do basic sanity checks on the HTTP response."]}),Object(i.jsx)("p",{children:"If you fail this test, please make sure:"}),Object(i.jsxs)("ul",{children:[Object(i.jsx)("li",{children:"This webpage is hosted by TINY server provided in your handout."}),Object(i.jsx)("li",{children:"You are browsing this page through your proxy (some browsers ignore proxy settings for localhost URL)."}),Object(i.jsxs)("li",{children:["Your proxy sends the correct ",Object(i.jsx)("code",{children:"User-Agent"})," header as described in writeup."]})]})]})},2],["proxy-resource-type",function(e){var t=e.bench,n=Object(a.useState)((function(){return x()})),r=Object(h.a)(n,2),c=r[0],o=(r[1],Object(a.useState)(0)),s=Object(h.a)(o,2),u=s[0],l=s[1],d=Object(a.useRef)(null),b=Object(a.useRef)(null),j=Object(a.useRef)(null),f=Object(a.useRef)(null);function g(e){t.log("failed to load ".concat(e),"error"),t.done(!1)}return Object(a.useEffect)((function(){t.log("URL arg is ?"+c,"debug")}),[c]),Object(a.useEffect)((function(){4===u&&t.done(!0)}),[t,u]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Proxy Resource Type Check"}),Object(i.jsx)("p",{children:"In this test, we request 1) a short Unicode text file, 2) a longer (500KB) text file, 3) an image and 4) an MP3 audio from the server."}),Object(i.jsx)("p",{children:"Your proxy should handle them correctly."}),Object(i.jsxs)("p",{children:["Note that HTTP responses may not have a ",Object(i.jsx)("code",{children:"Content-Length"})," header."]}),Object(i.jsxs)("p",{children:["Status: Loaded ",u," of them."]}),Object(i.jsx)("p",{children:"1)"}),Object(i.jsx)("iframe",{ref:d,title:"short text",src:"/cgi-bin/forwarder?"+c+",test_files/text.txt,text/plain;charset=utf-8",onLoad:function(){t.log("loaded text short"),m(t,(function(){y(d.current.contentDocument,"cannot get loaded document");var e=d.current.contentDocument.body.textContent;t.log("text short: "+e,"debug"),y(-1!==e.indexOf("\u5317\u4eac\u5927\u5b66"),"text short incorrect"),l((function(e){return e+1}))}))},onError:function(){return g("short text")}}),Object(i.jsx)("p",{children:"2)"}),Object(i.jsx)("iframe",{ref:b,title:"long text",src:"/cgi-bin/repeater?"+c+",50000,LoremIpsum,0",onLoad:function(){t.log("loaded text long"),m(t,(function(){y(b.current.contentDocument,"cannot get loaded document");var e=b.current.contentDocument.body.textContent;t.log("text long: "+e.substr(0,30)+"... length="+e.length,"debug"),y("LoremIpsumLoremIpsumLoremIpsum"===e.substr(0,30)&&5e5===e.length,"text long incorrect"),l((function(e){return e+1}))}))},onError:function(){return g("long text")}}),Object(i.jsx)("p",{children:"3)"}),Object(i.jsx)("img",{ref:j,alt:"img",src:"/cgi-bin/forwarder?"+c+",test_files/cornell-box.png,image/png",onLoad:function(){t.log("loaded image"),m(t,(function(){t.log("image dimension: "+j.current.naturalWidth+"*"+j.current.naturalHeight,"debug"),y(300===j.current.naturalHeight&&300===j.current.naturalWidth,"image incorrect"),l((function(e){return e+1}))}))},onError:function(){return g("image")}}),Object(i.jsx)("p",{children:"4)"}),Object(i.jsx)("audio",{ref:f,muted:!0,autoPlay:!0,controls:!0,src:"/cgi-bin/forwarder?"+c+",test_files/ki-ringtone-mono.mp3,audio/mp3",onCanPlay:function(){t.log("loaded mp3"),m(t,(function(){t.log("mp3 duration: "+f.current.duration,"debug"),y(f.current.duration>21&&f.current.duration<22,"mp3 incorrect"),l((function(e){return e+1}))}))},onError:function(){return g("mp3")}})]})},3],["proxy-speed",function(e){var t=e.bench,n=Object(a.useState)(0),r=Object(h.a)(n,2);return r[0],r[1],Object(a.useEffect)((function(){m(t,Object(f.a)(j.a.mark((function e(){var n,r,c,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=1;case 1:if(!(n<=100)){e.next=15;break}return r=x(),t.log("request #"+n+": URL arg ?"+r,"debug"),e.next=6,fetch("/cgi-bin/pingpong?"+r);case 6:return y(200===(c=e.sent).status,"in request #"+n+": status code is "+c.status+", expecting 200"),e.next=10,c.text();case 10:y(-1!==(o=e.sent).indexOf("ping-pong service"),"in request #"+n+": incorrect body: "+o);case 12:n++,e.next=1;break;case 15:t.done(!0);case 16:case"end":return e.stop()}}),e)}))))}),[t]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Proxy Speed Check"}),Object(i.jsx)("p",{children:"In this test, we fire 100 requests sequentially. Your proxy should get this work done quickly."})]})},4],["real-csapp",function(e){var t=e.bench;return Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Real Page CSAPP Check"}),Object(i.jsx)("p",{children:"The homepage of CSAPP book is a simple webpage. Hopefully your proxy can handle it."}),Object(i.jsx)("iframe",{src:"/test_files/csapp_3e/home.html",onLoad:function(e){m(t,Object(f.a)(j.a.mark((function n(){var r,c;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:y(e.target.contentDocument,"cannot get loaded document"),r=e.target.contentDocument.title,t.log("iframe loaded, title = "+r),y(-1!==r.indexOf("CS:APP"),'title should contains "CS:APP"'),y(1===(c=Array.from(e.target.contentDocument.querySelectorAll("img"))).length,"should have exactly one image on the webpage, but found "+c.length),t.done(!0);case 7:case"end":return n.stop()}}),n)}))))},onError:function(e){t.log("iframe failed to load","error"),t.done(!1)},style:{height:"500px",width:"600px",maxWidth:"unset"}})]})},3],["real-2048",function(e){var t=e.bench;return Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Real Page 2048 Check"}),Object(i.jsx)("p",{children:"Let's take a break and play 2048 now. We will automatically play the game by emulating keyboard events."}),Object(i.jsx)("p",{children:"Because 2048 is so hard :( , you pass this test after we get an 8."}),Object(i.jsx)("iframe",{src:"https://autolab.pku.edu.cn/2048-AI-master/index.html",onLoad:function(e){m(t,Object(f.a)(j.a.mark((function n(){var r,c,o,s,i,a;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,T(1e3);case 2:return r=e.target.contentWindow,n.next=5,D(r,{type:"ping"});case 5:c=n.sent,y("pong"==c.type,"failed to load iframe"),o=1;case 9:if(!(o<=40)){n.next=38;break}return n.next=12,T(100);case 12:return n.next=14,D(r,{type:"fire_kbd_event",which:37+o%4});case 14:return n.next=16,D(r,{type:"check"});case 16:if(s=n.sent,"finished"!=s.status){n.next=35;break}return t.log("we got an 8 after "+o+" moves"),t.log("We will check if the proxy is still working after 1s","debug"),n.next=23,T(1e3);case 23:return(i=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php")).search=new URLSearchParams({action:"getlist",p:"1",PKUHelperAPI:"3.0",jsapiver:"201027113050-"+2*Math.floor(+new Date/72e5),user_token:"HopePkuholeIsOperational"}).toString(),n.next=27,fetch(i);case 27:return y(401==(a=n.sent).status,"HTTP status code should be 401 because the user_token is invalid."),n.next=31,a.json();case 31:return y(1==n.sent.code,"code should be 1 because the user_token is invalid."),t.done(!0),n.abrupt("return");case 35:o++,n.next=9;break;case 38:t.log("still no 8 after 40 moves","error"),t.log("iframe text content = "+e.target.contentDocument.body.textContent,"debug"),t.done(!1);case 41:case"end":return n.stop()}}),n)}))))},onError:function(e){t.log("iframe failed to load","error"),t.done(!1)},style:{height:"500px",width:"400px",maxWidth:"unset"}})]})},8],["cache-concurrent",function(e){var t=e.bench,n=Object(a.useState)(0),r=Object(h.a)(n,2),c=r[0],o=r[1],s=Object(a.useState)(0),u=Object(h.a)(s,2),l=u[0],d=u[1],b=Object(a.useState)((function(){return v(0,10).map((function(){return-x()}))})),g=Object(h.a)(b,2),p=g[0];function O(e){e===c&&d((function(e){return e+1}))}function y(e){t.log("failed at step "+e,"error"),m(t,(function(){return k(!1)})),t.done(!1)}return g[1],Object(a.useEffect)((function(){t.log("step "+c),m(t,Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==c){e.next=9;break}return e.next=3,k(!1);case 3:t.log("URL args for step 1 and step 3: "+JSON.stringify(p.slice(0,5)),"debug"),t.log("URL args for step 4: "+JSON.stringify(p.slice(5)),"debug"),d(0),o(1),e.next=20;break;case 9:if(2!==c){e.next=16;break}return e.next=12,k(!0);case 12:d(0),o(3),e.next=20;break;case 16:if(5!==c){e.next=20;break}return e.next=19,k(!1);case 19:t.done(!0);case 20:case"end":return e.stop()}}),e)}))))}),[t,c]),Object(a.useEffect)((function(){1===c&&15===l?(d(0),o(2)):3===c&&15===l?(d(0),o(4)):4===c&&15===l&&(d(0),o(5))}),[c,l]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Cache Concurrency Check"}),Object(i.jsx)("p",{children:"In this test, we check the caching functionality of your proxy by these steps:"}),Object(i.jsxs)("ol",{children:[Object(i.jsxs)("li",{children:["Load ",5," images with different URL. Each image will be loaded ",3," times."]}),Object(i.jsx)("li",{children:"Tell TINY to stop responding to new requests."}),Object(i.jsxs)("li",{children:["Load these images again. Each image will be loaded ",3," times and they should be served by your proxy."]}),Object(i.jsxs)("li",{children:["Load ",5," new images, ",3," times each. These requests should fail because TINY has stopped responding."]}),Object(i.jsx)("li",{children:"Done :)"})]}),Object(i.jsxs)("p",{children:["Status: We are on step ",c," now."]}),Object(i.jsx)("table",{border:"1",children:Object(i.jsxs)("tbody",{children:[c>=1&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"URL"}),v(0,5).map((function(e){return Object(i.jsx)("td",{children:Object(i.jsxs)("a",{href:"/cgi-bin/forwarder?"+p[e]+",test_files/cornell-box.png,image/png",target:"_blank",children:["?",p[e]]})},e)}))]}),v(0,3).map((function(e){return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Step 1"}),v(0,5).map((function(e){return Object(i.jsx)("td",{children:Object(i.jsx)(w,{bench:t,src:"/cgi-bin/forwarder?"+p[e]+",test_files/cornell-box.png,image/png",onLoad:function(){return O(1)},onError:function(){return y(1)}})},e)}))]},e)}))]}),c>=3&&v(0,3).map((function(e){return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Step 3"}),v(0,5).map((function(e){return Object(i.jsx)("td",{children:Object(i.jsx)(w,{bench:t,src:"/cgi-bin/forwarder?"+p[e]+",test_files/cornell-box.png,image/png",onLoad:function(){return O(3)},onError:function(){return y(3)}})},e)}))]},e)})),c>=4&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"URL"}),v(0,5).map((function(e){return Object(i.jsx)("td",{children:Object(i.jsxs)("a",{href:"/cgi-bin/forwarder?"+p[5+e]+",test_files/cornell-box.png,image/png",target:"_blank",children:["?",p[5+e]]})},e)}))]}),v(0,3).map((function(e){return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Step 4"}),v(0,5).map((function(e){return Object(i.jsx)("td",{children:Object(i.jsx)(w,{bench:t,src:"/cgi-bin/forwarder?"+p[5+e]+",test_files/cornell-box.png,image/png",onError:function(){return O(4)},onLoad:function(){return y(4)}})},e)}))]},e)}))]})]})})]})},5],["cache-lru",function(e){var t=e.bench,n=Object(a.useState)(0),r=Object(h.a)(n,2),c=r[0],o=r[1],s=Object(a.useState)(0),u=Object(h.a)(s,2),l=u[0],d=u[1],b=Object(a.useState)((function(){return v(0,q).map((function(){return-x()}))})),g=Object(h.a)(b,2),p=g[0];function O(e){e===c&&d((function(e){return e+1}))}function y(e){t.log("failed at step "+e,"error"),m(t,(function(){return k(!1)})),t.done(!1)}return g[1],Object(a.useEffect)((function(){t.log("step "+c),m(t,Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==c){e.next=8;break}return e.next=3,k(!1);case 3:t.log("URL args for each image: "+JSON.stringify(p),"debug"),d(0),o(1),e.next=19;break;case 8:if(2!==c){e.next=15;break}return e.next=11,k(!0);case 11:d(0),o(3),e.next=19;break;case 15:if(5!==c){e.next=19;break}return e.next=18,k(!1);case 18:t.done(!0);case 19:case"end":return e.stop()}}),e)}))))}),[t,c]),Object(a.useEffect)((function(){1===c&&l===q?(d(0),o(2)):3===c&&3===l?(d(0),o(4)):4===c&&3===l&&(d(0),o(5))}),[c,l]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Cache LRU Check"}),Object(i.jsx)("p",{children:"In this test, we check the LRU nature of your caching proxy by these steps:"}),Object(i.jsxs)("ol",{children:[Object(i.jsxs)("li",{children:["Load images #0 ~ #",29," in a nearly sequential manner. Each image is of 50KB large so it should be added into cache."]}),Object(i.jsx)("li",{children:"Tell TINY to stop responding to new requests."}),Object(i.jsxs)("li",{children:["Load images #",27," ~ #",29," again. They should be served by your proxy."]}),Object(i.jsxs)("li",{children:["Load images #0 ~ #",2,". They should be evicted from cache; therefore these requests will fail."]}),Object(i.jsx)("li",{children:"Done :)"})]}),Object(i.jsxs)("p",{children:["We are on step ",c," now."]}),c>=1&&Object(i.jsxs)("div",{children:[Object(i.jsx)("h2",{children:"Step 1"}),Object(i.jsx)("p",{children:v(0,1===c?Math.min(l+2,q):q).map((function(e){return Object(i.jsxs)("span",{style:{display:"inline-block"},children:[Object(i.jsxs)("p",{children:["Image #",e," \u2193"]}),Object(i.jsx)("p",{children:Object(i.jsx)(w,{bench:t,src:"/cgi-bin/forwarder?"+p[e]+",test_files/cornell-box.png,image/png",onLoad:function(){return O(1)},onError:function(){return y(1)}})})]},e)}))})]}),c>=3&&Object(i.jsxs)("div",{children:[Object(i.jsx)("h2",{children:"Step 3"}),Object(i.jsx)("p",{children:v(27,q).map((function(e){return Object(i.jsxs)("span",{style:{display:"inline-block"},children:[Object(i.jsxs)("p",{children:["Image #",e," \u2193"]}),Object(i.jsx)("p",{children:Object(i.jsx)(w,{bench:t,src:"/cgi-bin/forwarder?"+p[e]+",test_files/cornell-box.png,image/png",onLoad:function(){return O(3)},onError:function(){return y(3)}})})]},e)}))})]}),c>=4&&Object(i.jsxs)("div",{children:[Object(i.jsx)("h2",{children:"Step 4"}),Object(i.jsx)("p",{children:v(0,3).map((function(e){return Object(i.jsxs)("span",{style:{display:"inline-block"},children:[Object(i.jsxs)("p",{children:["Image #",e," \u2193"]}),Object(i.jsx)("p",{children:Object(i.jsx)(w,{bench:t,src:"/cgi-bin/forwarder?"+p[e]+",test_files/cornell-box.png,image/png",onError:function(){return O(4)},onLoad:function(){return y(4)}})})]},e)}))})]})]})},5],["robust-concurrent",function(e){var t=e.bench,n=Object(a.useState)((function(){return function(){var e=v(0,10).map((function(){return x()}));return t.log("URL args for each row: "+JSON.stringify(e),"debug"),e}()})),r=Object(h.a)(n,2),c=r[0],o=(r[1],Object(a.useState)(0)),s=Object(h.a)(o,2),u=s[0],l=s[1];function d(e,n){t.log("failed to load ".concat(n," on row ").concat(e),"error"),t.done(!1)}return Object(a.useEffect)((function(){40===u&&t.done(!0)}),[t,u]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Robust Concurrency Check"}),Object(i.jsxs)("p",{children:["In this test, we load all 4 files described in ",Object(i.jsx)("code",{children:"proxy-resource-type"}),", ",10," times each."]}),Object(i.jsx)("p",{children:"It should be easy to pass this test unless your proxy crashes."}),Object(i.jsxs)("p",{children:["Status: Loaded ",u," of them."]}),Object(i.jsxs)("table",{children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"#"}),Object(i.jsx)("th",{children:"text (short)"}),Object(i.jsx)("th",{children:"text (long)"}),Object(i.jsx)("th",{children:"image"}),Object(i.jsx)("th",{children:"MP3"})]})}),Object(i.jsx)("tbody",{children:v(0,10).map((function(e){return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:e+1}),Object(i.jsx)("td",{children:Object(i.jsx)("iframe",{title:"short text",src:"/cgi-bin/forwarder?"+c[e]+",test_files/text.txt,text/plain;charset=utf-8",onLoad:function(n){return function(e,n){t.log("loaded text short on row "+e),m(t,(function(){y(n.target.contentDocument,"cannot get loaded document");var e=n.target.contentDocument.body.textContent;t.log("text short: "+e,"debug"),y(-1!==e.indexOf("\u5317\u4eac\u5927\u5b66"),"text short incorrect"),l((function(e){return e+1}))}))}(e+1,n)},onError:function(){return d(e+1,"short text")}})}),Object(i.jsx)("td",{children:Object(i.jsx)("iframe",{title:"long text",src:"/cgi-bin/repeater?"+c[e]+",6000,LoremIpsumLoremIpsum,0",onLoad:function(n){return function(e,n){t.log("loaded text long on row "+e),m(t,(function(){var e=n.target.contentDocument.body.textContent;t.log("text long: "+e.substr(0,30)+"... length="+e.length,"debug"),y("LoremIpsumLoremIpsumLoremIpsum"===e.substr(0,30)&&12e4===e.length,"text long incorrect"),l((function(e){return e+1}))}))}(e+1,n)},onError:function(){return d(e+1,"long text")}})}),Object(i.jsx)("td",{children:Object(i.jsx)("img",{alt:"img",src:"/cgi-bin/forwarder?"+c[e]+",test_files/cornell-box.png,image/png",onLoad:function(n){return function(e,n){t.log("loaded image on row "+e),m(t,(function(){t.log("image dimension: "+n.target.naturalWidth+"*"+n.target.naturalHeight,"debug"),y(300===n.target.naturalHeight&&300===n.target.naturalWidth,"image incorrect"),l((function(e){return e+1}))}))}(e+1,n)},onError:function(){return d(e+1,"image")}})}),Object(i.jsx)("td",{children:Object(i.jsx)("audio",{muted:!0,autoPlay:!0,controls:!0,src:"/cgi-bin/forwarder?"+c[e]+",test_files/ki-ringtone-mono.mp3,audio/mp3",onCanPlay:function(n){return function(e,n){t.log("loaded mp3 on row "+e),m(t,(function(){t.log("mp3 duration: "+n.target.duration,"debug"),n.target.pause(),y(n.target.duration>21&&n.target.duration<22,"mp3 incorrect"),l((function(e){return e+1}))}))}(e+1,n)},onError:function(){return d(e+1,"mp3")}})})]},e)}))})]})]})},8],["robust-bad-request",function(e){var t=e.bench;return Object(a.useEffect)((function(){m(t,Object(f.a)(j.a.mark((function e(){var n,r,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.log("1. POST http://pkunews.pku.edu.cn/"),fetch("http://pkunews.pku.edu.cn/",{method:"post",mode:"no-cors"}),e.next=4,T(100);case 4:return t.log("2. HEAD http://pkunews.pku.edu.cn/"),fetch("http://pkunews.pku.edu.cn/",{method:"head",mode:"no-cors"}),e.next=8,T(100);case 8:return t.log("3. GET https://pkunews.pku.edu.cn/"),fetch("https://pkunews.pku.edu.cn/",{mode:"no-cors"}),e.next=12,T(100);case 12:return t.log("4. GET http://127.0.0.1.nip.io:65432/"),fetch("http://127.0.0.1.nip.io:65432/",{mode:"no-cors"}),e.next=16,T(100);case 16:return t.log("5. GET http://maruyama.pico/"),fetch("http://maruyama.pico/",{mode:"no-cors"}),e.next=20,T(100);case 20:return t.log("6. GET http://pkunews.pku.edu.cn/LoremIpsum..."),fetch("http://pkunews.pku.edu.cn/"+S("LoremIpsum",3200),{mode:"no-cors"}),e.next=24,T(100);case 24:return t.log("We will check if the proxy is still working after 2s"),e.next=27,T(1900);case 27:return n=x(),t.log("Finally, GET /cgi-bin/pingpong?"+n),e.next=31,fetch("/cgi-bin/pingpong?"+n,{mode:"same-origin"});case 31:return r=e.sent,t.log("status code = "+r.status+" "+r.statusText),y(200===r.status,"bad status code, should be 200"),e.next=36,r.text();case 36:c=e.sent,t.log("response body = "+c,"debug"),y(-1!==c.toLowerCase().indexOf("this is ping-pong service."),'expecting "this is ping-pong service." in body'),t.done(!0);case 40:case"end":return e.stop()}}),e)}))))}),[t]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Robust Bad Request Check"}),Object(i.jsx)("p",{children:"In this test we make requests that your proxy might not recognize, in particular:"}),Object(i.jsxs)("ol",{children:[Object(i.jsx)("li",{children:"an HTTP request with POST method"}),Object(i.jsx)("li",{children:"an HTTP request with HEAD method"}),Object(i.jsx)("li",{children:"an HTTPS request (your proxy may receive an HTTP request with CONNECT method)"}),Object(i.jsx)("li",{children:"an HTTP request to a host that cannot be connected to"}),Object(i.jsx)("li",{children:"an HTTP request to a host that does not exist"}),Object(i.jsx)("li",{children:"an HTTP request with very long (32KB) URL"})]}),Object(i.jsx)("p",{children:"It is perfectly fine not to support them (except for HTTPS requests), but your proxy should not crash because of those requests."})]})},4],["robust-stream",function(e){var t=e.bench,n=Object(a.useState)(0),r=Object(h.a)(n,2),c=r[0],o=r[1],s=Object(a.useState)(0),u=Object(h.a)(s,2),l=u[0],d=u[1],b=Object(a.useState)((function(){return function(){var e=v(0,4).map((function(){return x()}));return t.log("URL args for time-consuming requests: "+JSON.stringify(e.slice(0,2)),"debug"),t.log("URL args for time-consuming requests after 1s: "+JSON.stringify(e.slice(2)),"debug"),e}()})),g=Object(h.a)(b,2),p=g[0],O=(g[1],Object(a.useState)(!1)),w=Object(h.a)(O,2),k=w[0],L=w[1];return Object(a.useEffect)((function(){c<5&&m(t,Object(f.a)(j.a.mark((function e(){var n,r,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(900);case 2:return n=x(8),t.log("pinging server #"+(c+1)+", URL arg ?"+n),e.next=6,Promise.race([fetch("/cgi-bin/pingpong?"+n),new Promise((function(e,t){setTimeout((function(){return t(new Error("ping request timeout (1s)"))}),1e3)}))]);case 6:return y(200===(r=e.sent).status,"status code = "+r.status+", should be 200"),e.next=10,r.text();case 10:y(-1!==(s=e.sent).toLowerCase().indexOf("this is ping-pong service."),"server respondeded: "+s),y(-1!==s.toLowerCase().indexOf(n),"server did not return correct serial: "+s),t.log("passed check","debug"),o(c+1);case 15:case"end":return e.stop()}}),e)}))),(function(){return!1}))}),[t,c]),Object(a.useEffect)((function(){setTimeout((function(){t.log("reloading these requests"),L(!0)}),1200)}),[t]),Object(a.useEffect)((function(){5===c&&2===l&&t.done(!0)}),[t,c,l]),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Robust Stream Check"}),Object(i.jsxs)("p",{children:["In this test, we request ",2," URLs that will take a long time (3s) to load."]}),Object(i.jsx)("p",{children:"We will change the URL after 1.2s (when they are still loading), probably bringing a SIGPIPE to your proxy."}),Object(i.jsxs)("p",{children:["Meanwhile, we routinely request ",Object(i.jsx)("code",{children:"/cgi-bin/pingpong"})," and expect the proxy to serve all requests concurrently."]}),Object(i.jsxs)("p",{children:["Status: Ping check ",c," / ",5,". Long request loaded ",l," / ",2,"."]}),Object(i.jsx)("div",{children:v(0,2).map((function(e){return Object(i.jsx)("iframe",Object(U.a)({title:"testing",src:"/cgi-bin/repeater?"+p[k?2+e:e]+",-15,LoremIpsumLoremIpsum,200"},k?{onLoad:function(n){return function(e,n){t.log("frame "+e+" loaded"),m(t,(function(){y(n.target.contentDocument,"cannot get loaded document");var e=n.target.contentDocument.body.textContent;y(0===e.indexOf("LoremIpsum"),"bad content: "+e.substr(200)),d((function(e){return e+1}))}))}(e,n)},onError:function(){return function(e){t.log("frame "+e+" load error","error"),t.done(!1)}(e)}}:{onLoad:function(n){return function(e,n){t.log("frame "+e+" (before URL change) loaded but it should not","error"),m(t,(function(){y(n.target.contentDocument,"cannot get loaded document"),y("content: "+n.target.contentDocument.body.textContent.substr(200),"debug")})),t.done(!1)}(e,n)},onError:function(){return function(e){t.log("frame "+e+" (before URL change) load error","error"),t.done(!1)}(e)}}),(k?2:0)+e)}))})]})},8]],H={};function A(e){var t=e.result,n=0,r=0,c=[];return N.forEach((function(e){var o=Object(h.a)(e,3),s=o[0],i=(o[1],o[2],t.get_status(s));i!==C&&r++,i===_?n++:i===I&&c.push(t.get_logs(s))})),Object(i.jsxs)("div",{children:[Object(i.jsxs)("h1",{children:["You passed ",Object(i.jsx)("b",{id:"grader-passed-num--DO-NOT-FAKE-THIS-OR-YOU-WILL-GET-SCORE-DEDUCTION",children:n})," tests"," ","out of ",r]}),0===c.length?Object(i.jsx)("p",{children:"Good Job :)"}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("p",{children:["Note that if your proxy crashes during a test, it fails subsequent tests."," ","Therefore it is recommended to debug the first failure first."]}),Object(i.jsx)("p",{children:'Press "Run" button on the left to re-run a specific test.'})]}),Object(i.jsxs)("div",{id:"grader-log-container",children:[c.length>0&&Object(i.jsx)("p",{children:"Below are logs of failed tests:"}),c.map((function(e,t){return Object(i.jsxs)("div",{children:[Object(i.jsx)("hr",{}),Object(i.jsx)(O,{children:e})]},t)}))]})]})}N.forEach((function(e,t){var n=Object(h.a)(e,3),r=n[0],c=n[1],o=n[2];H[r]={index:t,module:c,timeout:o}}));n(20);function W(){return Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Welcome to Browser TestBench"}),Object(i.jsx)("p",{children:"This testbench will emulate many web application behaviors in your browser."}),Object(i.jsxs)("p",{children:['Set up your proxy, press "Run All Tests" on the left, and see if your proxy can handle them correctly.'," ",'Run a specific test by pressing "Run" next to it.']}),Object(i.jsxs)("p",{children:["You can figure out what HTTP requests are actually made during a test by"," ","inserting appropriate ",Object(i.jsx)("code",{children:"printf"})," in your proxy program."," ","Other tools including the Network tab from your browser's developer tool might also be helpful. "," ","Consult writeup for debugging tips."]}),Object(i.jsx)("p",{children:"We will grade Real Pages score based on number of tests your proxy passes."})]})}var Y=function(){var e=Object(a.useRef)({is_auto:!1,fail_fast:!1}),t=Object(a.useState)((function(){return-1===navigator.userAgent.indexOf("proxylab_test_runner")})),n=Object(h.a)(t,2),r=n[0],c=n[1],o=Object(a.useState)(null),s=Object(h.a)(o,2),u=s[0],l=s[1];Object(a.useEffect)((function(){e.current&&(e.current.fail_fast=r),console.log("update fail fast",e.current)}),[r]),Object(a.useEffect)((function(){document.title="Browser Testbench"}),[]);var d=function(e){var t=Object(a.useRef)({}),n=Object(a.useReducer)((function(){return+new Date}),null),r=Object(h.a)(n,2),c=(r[0],r[1]);function o(){setTimeout(c,1)}return{clear_stats:function(){t.current={},o()},get_status:function(e){return(t.current[e]||{status:C}).status},get_logs:function(e){return(t.current[e]||{logs:["--- no logs ---","debug"]}).logs},start_bench:function(n){var r=x(6);return t.current[n]={status:R,logs:[["[".concat(p(),"] --- Running [").concat(n,"]"),"header"]],runkey:r},{bench_key:n,runkey:r,log:function(e){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";e="[".concat(p()," ").concat(c,"] ").concat(e);var s=t.current[n];s&&s.runkey===r?(console.log("log ".concat(n," (").concat(r,") ").concat(c,": ").concat(e)),s.logs.push([e,c]),o()):console.log("IGNORED to log ".concat(n," (").concat(r,"): ").concat(e))},done:function(c){var s=c?_:I,i=t.current[n];i&&i.runkey===r?(console.log("log ".concat(n," (").concat(r,"): ").concat(s)),i.logs.push(["[".concat(p(),"] TEST FINISHED. status = ").concat(s),c?"success":"error"]),i.status=s,i.runkey=null,e(n,s),o()):console.log("IGNORED to update status ".concat(n," (").concat(r,"): ").concat(s))},get_logs:function(){var e=t.current[n];return e?e.runkey?e.runkey!==r?[["--- test outdated ---","debug"]]:e.logs:e.logs.concat([["--- test stopped ---","debug"]]):[["--- test does not exist ---","debug"]]}}},kill_bench:function(e){var n=t.current[e];n&&n.runkey&&(console.log("KILLED ".concat(e," (").concat(n.runkey,")")),n.runkey=null,n.status===R&&(n.status=C),o())}}}((function(t,n){if(console.log("done_callback",e.current,t),e.current.is_auto){if(n===I&&e.current.fail_fast)return;var r=H[t].index;r<N.length-1?setTimeout((function(){b(N[r+1][0])}),150):l(null)}}));function b(e){u&&d.kill_bench(u.bench_key);var t=d.start_bench(e);l(t);var n=1e3*H[e].timeout;setTimeout((function(){t.log("TIMEOUT (".concat(n,"ms), killed"),"error"),t.done(!1)}),n)}var j=null;return u&&(j=H[u.bench_key].module),Object(i.jsxs)("div",{children:[Object(i.jsxs)("div",{className:"ui-sider",children:[Object(i.jsx)("p",{children:Object(i.jsx)("button",{onClick:function(){return e.current.is_auto=!0,d.clear_stats(),void b(N[0][0])},id:"grader-run-btn",children:"Run All Tests"})}),Object(i.jsx)("p",{children:Object(i.jsxs)("label",{children:[Object(i.jsx)("input",{type:"checkbox",checked:r,onChange:function(e){return c(e.target.checked)}}),"\xa0Stop on first failure"]})}),Object(i.jsxs)("table",{border:1,children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"Test"}),Object(i.jsx)("th",{children:"Status"})]})}),Object(i.jsx)("tbody",{children:N.map((function(t){var n=Object(h.a)(t,3),r=n[0];n[1],n[2];return Object(i.jsxs)("tr",{className:u&&u.bench_key===r?"bench-current":"",children:[Object(i.jsx)("td",{children:r}),Object(i.jsxs)("td",{className:"bench-status-"+d.get_status(r),children:[Object(i.jsx)("button",{onClick:function(){return t=r,e.current.is_auto=!1,void b(t);var t},children:"Run"}),"\xa0",d.get_status(r)]})]},r)}))})]})]}),Object(i.jsx)("div",{className:"ui-main",children:u?Object(i.jsxs)("div",{children:[Object(i.jsx)(j,{bench:u},u.runkey),Object(i.jsx)("hr",{}),Object(i.jsx)(O,{children:u.get_logs()})]}):e.current.is_auto?Object(i.jsx)(A,{result:d}):Object(i.jsx)(W,{})})]})},M=(n(21),function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var c;return Object(r.a)(this,n),(c=t.call(this,e)).state={error:null},c}return Object(c.a)(n,[{key:"render",value:function(){return this.state.error?Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"TestBench Error!"}),Object(i.jsx)("p",{children:"Please report this to your TA."}),Object(i.jsx)("p",{id:"grader-passed-num--DO-NOT-FAKE-THIS-OR-YOU-WILL-GET-SCORE-DEDUCTION",style:{color:"white",backgroundColor:"white"},children:"0 "}),Object(i.jsxs)("div",{id:"grader-log-container",children:[Object(i.jsx)("p",{className:"log-line-error",children:Object(i.jsx)("code",{children:""+this.state.error})}),Object(i.jsx)("p",{children:"Stack Trace:"}),Object(i.jsx)("pre",{children:Object(i.jsx)("code",{children:this.state.error.stack||"(not available)"})})]})]}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),n}(u.a.Component));d.a.render(Object(i.jsx)(u.a.StrictMode,{children:Object(i.jsx)(M,{children:Object(i.jsx)(Y,{})})}),document.getElementById("root"))}},[[22,1,2]]]);